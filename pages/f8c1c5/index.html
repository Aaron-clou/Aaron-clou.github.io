<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Statement versus Expression Syntax | Dafny</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/dafnycommunity/img/bgico2.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3282046_1qux519eoim.css">
    <script src="https://cdn.jsdelivr.net/npm/twikoo@1.5.0/dist/twikoo.all.min.js"></script>
    <meta name="description" content="Dafny中文社区">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/dafnycommunity/assets/css/0.styles.ecdcfe28.css" as="style"><link rel="preload" href="/dafnycommunity/assets/js/app.99d07194.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/2.ab4658c0.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/83.f08c5aed.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/7.5451cfed.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/4.06497870.js" as="script"><link rel="prefetch" href="/dafnycommunity/assets/js/10.ac38cab7.js"><link rel="prefetch" href="/dafnycommunity/assets/js/11.38d5ee16.js"><link rel="prefetch" href="/dafnycommunity/assets/js/12.c434ce94.js"><link rel="prefetch" href="/dafnycommunity/assets/js/13.4e922264.js"><link rel="prefetch" href="/dafnycommunity/assets/js/14.db841cfa.js"><link rel="prefetch" href="/dafnycommunity/assets/js/15.b9c227cc.js"><link rel="prefetch" href="/dafnycommunity/assets/js/16.41dadc32.js"><link rel="prefetch" href="/dafnycommunity/assets/js/17.48b5f1eb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/18.ec254833.js"><link rel="prefetch" href="/dafnycommunity/assets/js/19.288ca382.js"><link rel="prefetch" href="/dafnycommunity/assets/js/20.cfeb5fdb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/21.ce8ddc5a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/22.1b8c89f0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/23.cb062ace.js"><link rel="prefetch" href="/dafnycommunity/assets/js/24.ff271672.js"><link rel="prefetch" href="/dafnycommunity/assets/js/25.5541f3af.js"><link rel="prefetch" href="/dafnycommunity/assets/js/26.a1bbc4cb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/27.522d7884.js"><link rel="prefetch" href="/dafnycommunity/assets/js/28.9335c003.js"><link rel="prefetch" href="/dafnycommunity/assets/js/29.3fc0b07a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/3.ab8a97d8.js"><link rel="prefetch" href="/dafnycommunity/assets/js/30.57708681.js"><link rel="prefetch" href="/dafnycommunity/assets/js/31.8571b949.js"><link rel="prefetch" href="/dafnycommunity/assets/js/32.f91be5de.js"><link rel="prefetch" href="/dafnycommunity/assets/js/33.8089c59b.js"><link rel="prefetch" href="/dafnycommunity/assets/js/34.874d0299.js"><link rel="prefetch" href="/dafnycommunity/assets/js/35.aff8adfd.js"><link rel="prefetch" href="/dafnycommunity/assets/js/36.ac78b86e.js"><link rel="prefetch" href="/dafnycommunity/assets/js/37.3fae0334.js"><link rel="prefetch" href="/dafnycommunity/assets/js/38.3db4a8d6.js"><link rel="prefetch" href="/dafnycommunity/assets/js/39.e585cc70.js"><link rel="prefetch" href="/dafnycommunity/assets/js/40.afcb8fbe.js"><link rel="prefetch" href="/dafnycommunity/assets/js/41.01f314da.js"><link rel="prefetch" href="/dafnycommunity/assets/js/42.8e4fe21d.js"><link rel="prefetch" href="/dafnycommunity/assets/js/43.571fb232.js"><link rel="prefetch" href="/dafnycommunity/assets/js/44.14aebad2.js"><link rel="prefetch" href="/dafnycommunity/assets/js/45.32f18970.js"><link rel="prefetch" href="/dafnycommunity/assets/js/46.ce0d522f.js"><link rel="prefetch" href="/dafnycommunity/assets/js/47.0bd83351.js"><link rel="prefetch" href="/dafnycommunity/assets/js/48.648f667a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/49.83709ae0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/5.b8548e7f.js"><link rel="prefetch" href="/dafnycommunity/assets/js/50.060e0424.js"><link rel="prefetch" href="/dafnycommunity/assets/js/51.a1291856.js"><link rel="prefetch" href="/dafnycommunity/assets/js/52.45f73497.js"><link rel="prefetch" href="/dafnycommunity/assets/js/53.525782ca.js"><link rel="prefetch" href="/dafnycommunity/assets/js/54.45a04a86.js"><link rel="prefetch" href="/dafnycommunity/assets/js/55.65a94ba0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/56.2d038113.js"><link rel="prefetch" href="/dafnycommunity/assets/js/57.579db650.js"><link rel="prefetch" href="/dafnycommunity/assets/js/58.832d4c89.js"><link rel="prefetch" href="/dafnycommunity/assets/js/59.13befb53.js"><link rel="prefetch" href="/dafnycommunity/assets/js/6.349bf431.js"><link rel="prefetch" href="/dafnycommunity/assets/js/60.41227bb1.js"><link rel="prefetch" href="/dafnycommunity/assets/js/61.1d1b92f4.js"><link rel="prefetch" href="/dafnycommunity/assets/js/62.2cdbc236.js"><link rel="prefetch" href="/dafnycommunity/assets/js/63.83de9482.js"><link rel="prefetch" href="/dafnycommunity/assets/js/64.4ecd0d25.js"><link rel="prefetch" href="/dafnycommunity/assets/js/65.25118b81.js"><link rel="prefetch" href="/dafnycommunity/assets/js/66.cdab1b54.js"><link rel="prefetch" href="/dafnycommunity/assets/js/67.655e6e84.js"><link rel="prefetch" href="/dafnycommunity/assets/js/68.84effb44.js"><link rel="prefetch" href="/dafnycommunity/assets/js/69.8f07f81a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/70.d9a299e6.js"><link rel="prefetch" href="/dafnycommunity/assets/js/71.16ef2000.js"><link rel="prefetch" href="/dafnycommunity/assets/js/72.8252acc5.js"><link rel="prefetch" href="/dafnycommunity/assets/js/73.f53e39bc.js"><link rel="prefetch" href="/dafnycommunity/assets/js/74.5ef910c4.js"><link rel="prefetch" href="/dafnycommunity/assets/js/75.72174d00.js"><link rel="prefetch" href="/dafnycommunity/assets/js/76.bebf75c9.js"><link rel="prefetch" href="/dafnycommunity/assets/js/77.b85547c7.js"><link rel="prefetch" href="/dafnycommunity/assets/js/78.a0a1f574.js"><link rel="prefetch" href="/dafnycommunity/assets/js/79.a731d645.js"><link rel="prefetch" href="/dafnycommunity/assets/js/8.522ce892.js"><link rel="prefetch" href="/dafnycommunity/assets/js/80.6e5b64b0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/81.6e19e312.js"><link rel="prefetch" href="/dafnycommunity/assets/js/82.9244e788.js"><link rel="prefetch" href="/dafnycommunity/assets/js/84.085ef3f8.js"><link rel="prefetch" href="/dafnycommunity/assets/js/85.c41e6e0e.js"><link rel="prefetch" href="/dafnycommunity/assets/js/86.e3798708.js"><link rel="prefetch" href="/dafnycommunity/assets/js/87.fdac1c1c.js"><link rel="prefetch" href="/dafnycommunity/assets/js/88.665ac8c8.js"><link rel="prefetch" href="/dafnycommunity/assets/js/89.78dc55eb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/9.4d4f4bdb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/90.4757b202.js"><link rel="prefetch" href="/dafnycommunity/assets/js/91.a0746cf2.js">
    <link rel="stylesheet" href="/dafnycommunity/assets/css/0.styles.ecdcfe28.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dafnycommunity/" class="home-link router-link-active"><img src="/dafnycommunity/img/logo-2.png" alt="Dafny" class="logo"> <span class="site-name can-hide">Dafny</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dafnycommunity/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="配置" class="dropdown-title"><a href="/dafnycommunity/peizhi/" class="link-title">配置</a> <span class="title" style="display:none;">配置</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>入门介绍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/56e571/" class="nav-link">什么是dafny?</a></li></ul></li><li class="dropdown-item"><h4>用起来吧！</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/4fa796/" class="nav-link">安装</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/085606/" class="nav-link">快速上手</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/39fb20/" class="nav-link">可能遇到的问题?</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/dafnycommunity/zhinan/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny快速入门</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/6e15a6/" class="nav-link">基础学习 Basic</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/eba166/" class="nav-link">方法 Method</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/83cdf9/" class="nav-link">关键字 Keyword</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/01d76e/" class="nav-link">函数 Function</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0fadc1/" class="nav-link">类 Class </a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a010ab/" class="nav-link">泛型 Generics</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/c4fda3/" class="nav-link">声明 Statement</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e8438e/" class="nav-link">表达式 Expression</a></li></ul></li><li class="dropdown-item"><h4>Dafny简单例子</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0978ce/" class="nav-link">寻找最大最小数和</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e3e481/" class="nav-link">斐波那契数列</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/02fdef/" class="nav-link">线性查询</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9b332b/" class="nav-link">引理-计算序列非负元素个数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/3d1110/" class="nav-link">集合</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2146d4/" class="nav-link">终止</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/dafnycommunity/jiaocheng/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny指导</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/877eb3/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/bf40c0/" class="nav-link">方法 Methods</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2e0c73/" class="nav-link">前置/后置条件 Pre/Postconditions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/36c1b4/" class="nav-link">断言 Assertions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a1d5a4/" class="nav-link">函数 Functions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/d89435/" class="nav-link">循环不变体 Loop Invariants</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/828a83/" class="nav-link">数组 Arrays</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/17e8d1/" class="nav-link">量词(函数) Quantifiers</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cc01af/" class="nav-link">谓词(函数) Predicates</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/13bbcd/" class="nav-link">框架 Framing</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1319be/" class="nav-link">二分搜索 Binary Search</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/30a8c2/" class="nav-link">总结</a></li></ul></li><li class="dropdown-item"><h4>Dafny进阶语法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/273cac/" class="nav-link">引理和归纳 Lemmas and Induction</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9d19b8/" class="nav-link">模块 Modules</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/b9300a/" class="nav-link">集合 sets</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cb3d21/" class="nav-link">序列 sequence</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fc6196/" class="nav-link">终止 Terminal</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a2a107/" class="nav-link">值类型 Values Types</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/dafnycommunity/ziyuan/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>实践探索</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/718207/" class="nav-link">自动归纳</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1f579f/" class="nav-link">自动调用引理</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/f6638c/" class="nav-link">定义、证明、算法正确性</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1d2420/" class="nav-link">各种推导式</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/20c275/" class="nav-link">不同类型的证明</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/67167e/" class="nav-link">集合元素上的函数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/be298d/" class="nav-link">在集合上的迭代</a></li></ul></li><li class="dropdown-item"><h4>常用工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/8065fd/" class="nav-link">Type System</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0f17ab/" class="nav-link">Style Guide</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fe5721/" class="nav-link">Cheet Sheet</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/1b94a4/" class="nav-link">✨收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️语言" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dafnycommunity/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/dafnycommunity/en-US/" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/caf1f9/" class="nav-link">💬社区留言板</a></div> <a href="https://github.com/aaron-clou/dafnycommunity" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://s1.ax1x.com/2022/04/01/qh3tDe.png"> <div class="blogger-info"><h3>Dafny</h3> <span>新一代验证语言</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/dafnycommunity/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="配置" class="dropdown-title"><a href="/dafnycommunity/peizhi/" class="link-title">配置</a> <span class="title" style="display:none;">配置</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>入门介绍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/56e571/" class="nav-link">什么是dafny?</a></li></ul></li><li class="dropdown-item"><h4>用起来吧！</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/4fa796/" class="nav-link">安装</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/085606/" class="nav-link">快速上手</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/39fb20/" class="nav-link">可能遇到的问题?</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/dafnycommunity/zhinan/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny快速入门</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/6e15a6/" class="nav-link">基础学习 Basic</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/eba166/" class="nav-link">方法 Method</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/83cdf9/" class="nav-link">关键字 Keyword</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/01d76e/" class="nav-link">函数 Function</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0fadc1/" class="nav-link">类 Class </a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a010ab/" class="nav-link">泛型 Generics</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/c4fda3/" class="nav-link">声明 Statement</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e8438e/" class="nav-link">表达式 Expression</a></li></ul></li><li class="dropdown-item"><h4>Dafny简单例子</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0978ce/" class="nav-link">寻找最大最小数和</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e3e481/" class="nav-link">斐波那契数列</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/02fdef/" class="nav-link">线性查询</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9b332b/" class="nav-link">引理-计算序列非负元素个数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/3d1110/" class="nav-link">集合</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2146d4/" class="nav-link">终止</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/dafnycommunity/jiaocheng/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny指导</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/877eb3/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/bf40c0/" class="nav-link">方法 Methods</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2e0c73/" class="nav-link">前置/后置条件 Pre/Postconditions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/36c1b4/" class="nav-link">断言 Assertions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a1d5a4/" class="nav-link">函数 Functions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/d89435/" class="nav-link">循环不变体 Loop Invariants</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/828a83/" class="nav-link">数组 Arrays</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/17e8d1/" class="nav-link">量词(函数) Quantifiers</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cc01af/" class="nav-link">谓词(函数) Predicates</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/13bbcd/" class="nav-link">框架 Framing</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1319be/" class="nav-link">二分搜索 Binary Search</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/30a8c2/" class="nav-link">总结</a></li></ul></li><li class="dropdown-item"><h4>Dafny进阶语法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/273cac/" class="nav-link">引理和归纳 Lemmas and Induction</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9d19b8/" class="nav-link">模块 Modules</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/b9300a/" class="nav-link">集合 sets</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cb3d21/" class="nav-link">序列 sequence</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fc6196/" class="nav-link">终止 Terminal</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a2a107/" class="nav-link">值类型 Values Types</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/dafnycommunity/ziyuan/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>实践探索</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/718207/" class="nav-link">自动归纳</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1f579f/" class="nav-link">自动调用引理</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/f6638c/" class="nav-link">定义、证明、算法正确性</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1d2420/" class="nav-link">各种推导式</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/20c275/" class="nav-link">不同类型的证明</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/67167e/" class="nav-link">集合元素上的函数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/be298d/" class="nav-link">在集合上的迭代</a></li></ul></li><li class="dropdown-item"><h4>常用工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/8065fd/" class="nav-link">Type System</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0f17ab/" class="nav-link">Style Guide</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fe5721/" class="nav-link">Cheet Sheet</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/1b94a4/" class="nav-link">✨收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️语言" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dafnycommunity/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/dafnycommunity/en-US/" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/caf1f9/" class="nav-link">💬社区留言板</a></div> <a href="https://github.com/aaron-clou/dafnycommunity" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dafny-quick-start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dafny-tutorials</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>detailed-document</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>publication-lecture</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dafnycommunity/pages/a9363c/" class="sidebar-link">Automatic Induction</a></li><li><a href="/dafnycommunity/pages/30441e/" class="sidebar-link">Calling Lemmas Automatically</a></li><li><a href="/dafnycommunity/pages/746026/" class="sidebar-link">Case study of definitions, proofs, algorithm correctness GCD</a></li><li><a href="/dafnycommunity/pages/da6921/" class="sidebar-link">Comprehensions</a></li><li><a href="/dafnycommunity/pages/8d8607/" class="sidebar-link">Different Styles of Proofs</a></li><li><a href="/dafnycommunity/pages/097ba0/" class="sidebar-link">Functions over Set Elements</a></li><li><a href="/dafnycommunity/pages/c4484e/" class="sidebar-link">Iterating over a Collection</a></li><li><a href="/dafnycommunity/pages/7fe522/" class="sidebar-link">old and unchanged</a></li><li><a href="/dafnycommunity/pages/369e25/" class="sidebar-link">Short-Circuit Operators</a></li><li><a href="/dafnycommunity/pages/f8c1c5/" aria-current="page" class="active sidebar-link">Statement versus Expression Syntax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/f8c1c5/#_0-if-statements-and-if-then-else-expressions" class="sidebar-link">0. If Statements and If-Then-Else Expressions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_0-0-if-case-statements" class="sidebar-link">0.0. If-case Statements</a></li><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_0-1-indiscriminate-choice" class="sidebar-link">0.1. Indiscriminate Choice</a></li><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_0-2-binding-guards" class="sidebar-link">0.2. Binding Guards</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/f8c1c5/#_1-match-statements-and-match-expressions" class="sidebar-link">1. Match Statements and Match Expressions</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/f8c1c5/#_2-local-variables-and-let-bindings" class="sidebar-link">2. Local Variables and Let Bindings</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_2-0-ghost-variables" class="sidebar-link">2.0. Ghost Variables</a></li><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_2-1-patterns" class="sidebar-link">2.1. Patterns</a></li><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_2-2-assign-such-that-statements-and-let-such-that-expressions" class="sidebar-link">2.2. Assign-Such-That Statements and Let-Such-That Expressions</a></li><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_2-3-upates" class="sidebar-link">2.3. Upates</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/f8c1c5/#_3-statement-expressions" class="sidebar-link">3. Statement Expressions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dafnycommunity/pages/f8c1c5/#_3-0-lemmas-with-out-parameters" class="sidebar-link">3.0. Lemmas with out-parameters</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/f8c1c5/#_4-putting-it-all-together" class="sidebar-link">4. Putting it all together</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/dafnycommunity/pages/f8c1c5/#acknowledgments" class="sidebar-link">Acknowledgments</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/f8c1c5/#references" class="sidebar-link">References</a></li></ul></li><li><a href="/dafnycommunity/pages/5a4346/" class="sidebar-link">The Parent Trick for proving termination and a function-by-method use case</a></li><li><a href="/dafnycommunity/pages/c45b5a/" class="sidebar-link">Type-Parameter Completion</a></li><li><a href="/dafnycommunity/pages/3c9a0b/" class="sidebar-link">Type-parameter modes variance and cardinality preservation</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/dafnycommunity/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/dafnycommunity/en-US/#语言" data-v-0c557b5e>语言</a></li><li data-v-0c557b5e><a href="/dafnycommunity/en-US/#publication-lecture" data-v-0c557b5e>publication-lecture</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/Aaron-clou" target="_blank" title="作者" class="beLink" data-v-0c557b5e>lijiahai</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-03-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Statement versus Expression Syntax<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>Dafny Power User:
Statement versus Expression Syntax</p> <p>K. Rustan M. Leino</p> <p>Manuscript KRML 266, 17 May 2019</p> <p><strong>Abstract.</strong> This note describes some constructs that exist in both a statement form and an expression form in Dafny. It points out the syntactic similarities and differences between the two forms, and discusses related constructs.</p> <p>Dafny distinguishes between <em>statements</em> and <em>expressions</em>. For example, the body of a <code>method</code> is a statement whereas the body of a <code>function</code> is an expression. A statement can assign to local variables, allocate and mutate objects in the heap, use loops in control flow, and be nondeterministic. An expression cannot do any of those things. Instead, it can bind values to bound variables, read values in the heap, use recursion, and is always deterministic. Syntactically, most statements are terminated with a semi-colon and sometimes a sequence of statements is surrounded by curly braces. A few expressions contain semi-colons, but never at the end, and an expression can be surrounded by round parentheses.</p> <p>Let's take a look at some constructs that exist in both a statement form and an expression form.</p> <h2 id="_0-if-statements-and-if-then-else-expressions"><a href="#_0-if-statements-and-if-then-else-expressions" class="header-anchor">#</a> 0. If Statements and If-Then-Else Expressions</h2> <p>Of constructs that exist in both statement and expression form, the <em>conditional</em> (<code>if</code>) is probably the most common, and it is also the one with the most conspicuous difference between the two forms.</p> <p>The conditional statement is the <code>if</code> statement, which has a “then” branch and an optional “else” branch. The “then” branch is always a block statement, which is necessarily surrounded by curly braces. The “else” branch, if present, is either a block statement or another <code>if</code> statement.</p> <p>For example, the following statement declares local variables <code>min</code> and <code>max</code> that are assigned according to the relative sizes of <code>x</code> and <code>y</code>:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var min, max;
if x &lt; y {
  min, max := x, y;
} else {
  min, max := y, x;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Notice that <code>min</code> and <code>max</code> are declared before the <code>if</code> statement (Dafny will infer the types of these two variables), which means they are still in scope after the whole <code>if</code> statement. If these variables were instead declared inside each branch, they would go out of scope at the curly brace that ends each respective block statement.</p> <p>The conditional expression is the <code>if</code>-<code>then</code>-<code>else</code> expression. Unlike the <code>if</code> statement, the expression form uses the keyword <code>then</code> to separate the guard from the “then” branch, and always requires and explicit “else” branch. For example, an expression that returns the smaller of <code>x</code> and <code>y</code> is:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if x &lt; y then x else y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Such expressions can be used as right-hand sides of assignments to local variables:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var min, max := if x &lt; y then x else y, if x &lt; y then y else x;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>For this example, we can also use a single <code>if</code>-<code>then</code>-<code>else</code> expression where each branch results in a pair. We can assign that pair to a variable, and then assign the pair's components to <code>min</code> and <code>max</code>:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var minmax := if x &lt; y then (x,y) else (y,x);
var min, max := minmax.0, minmax.1;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The following shows an example of nested and cascaded <code>if</code> statements:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var middle;
if x &lt; y {
  if y &lt; z {
    middle := y;
  } else if z &lt; x {
    middle := x;
  } else {
    middle := z;
  }
} else {
  if x &lt; z {
    middle := x;
  } else if z &lt; y {
    middle := y;
  } else {
    middle := z;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>And here is the analogous program using conditional expressions:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var middle :=
  if x &lt; y then
    if y &lt; z then y else if z &lt; x then x else z
  else
    if x &lt; z then x else if z &lt; y then y else z;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>For statements, there are some additional forms of conditionals. Because these forms allow nondeterminism, there statements do exist in an analogous expression form. The next few subsections describe these additional conditional statements.</p> <h3 id="_0-0-if-case-statements"><a href="#_0-0-if-case-statements" class="header-anchor">#</a> 0.0. If-case Statements</h3> <p>One additional form of conditional statements is the <em><code>if</code>-<code>case</code> statement</em>. Instead of two mutually exclusive branches, the <code>if</code>-<code>case</code> statement provides any number of branches (cases, alternatives), and their conditions need not be mutually exclusive. Syntactically, the <code>if</code>-<code>case</code> statement follows the keyword <code>if</code> with ones or more branches of the form</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>case Guard =&gt; Body
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>where <code>Guard</code> is an expression and <code>Body</code> is a list of statements.</p> <p>For example, the computation of <code>min</code>/<code>max</code> can be written as follows:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var min, max;
if
case x &lt;= y =&gt;
  min, max := x, y;
case y &lt;= x =&gt;
  min, max := y, x;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Note that <code>&lt;=</code> is the “at most” (or, some say “less than or equal to”) operator, whereas <code>=&gt;</code> is the piece of syntax that separates the guard and body of each case.</p> <p>The <code>if</code>-<code>case</code> statement picks any one of the cases whose guard evaluates to <code>true</code>. The ordering of the cases is not relevant. In the example above, if <code>x</code> and <code>y</code> are equal, then the choice of which <code>case</code> to execute is nondeterminstic. For this example, it so happens that both cases have the same effect if <code>x</code> and <code>y</code> are equal, but that need not be so. Not having to specify which branch to take when the choice is irrelevant frees the programmer's mind and, arguably, results in a cleaner, more symmetric, and more abstract program.</p> <p>Each <code>case</code> gives rise to a new block scope, despite the fact that the body is a list of statements, not a block statement. In other words, any local variables declared in one <code>case</code> go out of scope where the <code>case</code> ends.</p> <p>The body of a <code>case</code> continues until the next <code>case</code> begins or until the enclosing block ends. If you want to end the last <code>case</code> sooner, you could surround the entire <code>if</code>-<code>case</code> statement with a pair of curly braces, but that doesn't look so nice. Therefore, Dafny optionally allows the set of cases to be enclosed in a pair of curly braces, like this:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var min, max;
if {
  case x &lt;= y =&gt;
    min, max := x, y;
  case y &lt;= x =&gt;
    min, max := y, x;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>An <code>if</code>-<code>case</code> statement can have any number of branches. For example:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var middle;
if {
  case x &lt;= y &lt;= z =&gt;  middle := y;
  case z &lt;= y &lt;= x =&gt;  middle := y;
  case y &lt;= x &lt;= z =&gt;  middle := x;
  case z &lt;= x &lt;= y =&gt;  middle := x;
  case y &lt;= z &lt;= x =&gt;  middle := z;
  case x &lt;= z &lt;= y =&gt;  middle := z;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>As I mentioned, if more than one guard evaluates to <code>true</code>, Dafny may choose to execute any one of the the corresponding bodies (but only one!). What if none of the guards evaluates to <code>true</code>? That is not allowed, and the verifier will report an error if it cannot prove that at least one case applies.</p> <h3 id="_0-1-indiscriminate-choice"><a href="#_0-1-indiscriminate-choice" class="header-anchor">#</a> 0.1. Indiscriminate Choice</h3> <p>When Dafny is used as a modeling language, one may want to write down several statements that can be chosen between indiscriminately. This can be done by writing <code>*</code> in place of the guard expression in the common <code>if</code> statement.</p> <p>For example, the effect of the statement</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if * {
  S;
} else if * {
  T;
} else {
  U;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>is to execute one of the statements <code>S</code>, <code>T</code>, or <code>U</code>, but you can never predict which one of those statements will be chosen.</p> <p>Such an indiscriminate choice can also be written using an <code>if</code>-<code>case</code> statement:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if
case true =&gt;  S;
case true =&gt;  T;
case true =&gt;  U;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_0-2-binding-guards"><a href="#_0-2-binding-guards" class="header-anchor">#</a> 0.2. Binding Guards</h3> <p>Finally, both the common <code>if</code> statement and the <code>if</code>-<code>case</code> statement allow guards to introduce a variable with some constraints. These are called <em>binding guards</em>.</p> <p>For example, suppose you want to perform an operation to an arbitrary even number in a given set, unless the set contains no even number, in which case you want to do something else. One way to accomplish this is to write an <code>if</code> statement whose then branch uses an <em>assign-such-that statement</em> to pick such an element:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if exists x :: x in S &amp;&amp; x % 2 == 0 {
  var x :| x in S &amp;&amp; x % 2 == 0;
  ProcessEven(x);
} else {
  ProcessEmpty();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>But there is a lot of duplication between the existential quantifier in the guard and the assign-such-that statement in the then branch. With a binding guard, the same program can be written as follows:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if x :| x in S &amp;&amp; x % 2 == 0 {
  ProcessEven(x);
} else {
  ProcessEmpty();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This statement introduces <code>x</code> and picks as its value any value satisfying the condition following the <code>:|</code>. If no such <code>x</code> exists, the else branch is executed. The bound variable <code>x</code> is in scope only in the then branch.</p> <p>Similarly, suppose you want to pick an even number from a set and apply some operation to it, or pick an odd number from the set and apply some other operation to it, or do something else if the set contains neither an even nor an odd number. Then you can use an <code>if</code>-<code>case</code> statement with binding guards:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if
case x :| x in S &amp;&amp; x % 2 == 0 =&gt;
  ProcessEven(x);
case x :| x in S &amp;&amp; x % 2 == 1 =&gt;
  ProcessOdd(x);
case S == {} =&gt;
  ProcessEmpty();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Note that if <code>S</code> contains both even and odd numbers, then Dafny may pick either of the first two cases.</p> <h2 id="_1-match-statements-and-match-expressions"><a href="#_1-match-statements-and-match-expressions" class="header-anchor">#</a> 1. Match Statements and Match Expressions</h2> <p>Another branching construct is <code>match</code>, which also comes in a statement form and in an expression form. The syntax of these two are identical, except that each body of the former is a list of statements where each body of the latter is an expression. These have the forms</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match s
case A(x) =&gt;
  StmtList0;
case B(y) =&gt;
  StmtList1;
case C(z) =&gt;
  StmtList2;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>and</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match s
case A(x) =&gt; Expr0
case B(y) =&gt; Expr1
case C(z) =&gt; Expr2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>respectively.</p> <p>What follows the keyword <code>case</code> is a <em>pattern</em>, which looks like an expression built of datatype constructors and bound variables. For example, consider the standard datatype definition for a list, parameterized by an element type <code>T</code>:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>datatype List&lt;T&gt; = Nil | Cons(T, List&lt;T&gt;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The following expression returns the minimum of <code>2</code> and the length of a list <code>xs</code>:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match xs
case Nil =&gt; 0
case Cons(x, Nil) =&gt; 1
case Cons(x, Cons(y, ys)) =&gt; 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Unlike in several other programming languages, the cases of a <code>match</code> in Dafny are unordered. A bound variable that is not used can be replaced by an underscore, <code>_</code>. So, the <code>match</code> expression above can be written equivalently as</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match xs
case Cons(_, Nil) =&gt; 1
case Cons(_, Cons(_, _)) =&gt; 2
case Nil =&gt; 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Analogously to the <code>if</code>-<code>case</code> statement, each <code>case</code> of a <code>match</code> statement is implicitly a lexical scope. In other words, any local variables declared in one <code>case</code> goes out of scope at the end of that branch.</p> <p>Also as for the <code>if</code>-<code>case</code> statement, each <code>case</code> of a <code>match</code> goes as far as possible, but not past another <code>case</code>. To end a case early, the set of cases can be enclosed in a pair of curly braces. For example:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match xs
case Cons(_, ys) =&gt;
  match ys {
    case Cons(_, _) =&gt; 2
    case Nil =&gt; 1
  }
case Nil =&gt; 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Note that curly braces, not parentheses, are used in this way for both <code>match</code> statements and <code>match</code> expressions. One can, of course, also surround an entire <code>match</code> expression with parentheses, so the expression above can be written equivalently as:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match xs
case Cons(_, ys) =&gt;
  (match ys
   case Cons(_, _) =&gt; 2
   case Nil =&gt; 1)
case Nil =&gt; 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>In some situations, it may also be possible to simply reorder the cases for the same effect:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>match xs
case Nil =&gt; 0
case Cons(_, ys) =&gt;
  match ys
  case Nil =&gt; 1
  case Cons(_, _) =&gt; 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_2-local-variables-and-let-bindings"><a href="#_2-local-variables-and-let-bindings" class="header-anchor">#</a> 2. Local Variables and Let Bindings</h2> <p>The statement that introduces a local variable has the form:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x: int := 17;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The type decoration &quot;<code>: int</code>“ is needed only if Dafny cannot infer the type, so it is typically omitted. The assignment of an initial value, here ”<code>:= 17</code>&quot;, can also be omitted, if the initial value of the variable is irrelevant. (If the variable is used before the program explicitly assigns to it, Dafny will initialize the variable to an arbitrary value of its type.) The variable introduced stays in scope until the current lexical scope ends (typically at the next close-curly-brace).</p> <p>A <code>var</code> statement can introduce several variables. If so, any type decoration acts only on the variable it follows. That is, you can think of <code>:</code> as having higher binding power than the <code>,</code> that separates the variable names. If an initial assignment is used, it must give a value to all variables being declared. For example,</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var a, b: bool, c := 13, true, 8.29;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>declares an integer variable <code>a</code>, a boolean variable <code>b</code>, and a real-valued variable <code>c</code>.</p> <p>The following example introduces three local variables, <code>z</code>, <code>x</code>, and <code>y</code>, and arranges in a complicated way to set <code>z</code> to <code>0</code> (where <code>k</code> is some integer variable in the enclosing scope):</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var z;
var x, y := k, k;
z := x - y;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>There is a form of the <code>var</code> statement in expressions: the <em>let expression</em>. The variables introduced by let expressions are usually called <em>bound variables</em> or <em>let-bound variables</em>. The syntax of the let expression is like the <code>var</code> statement, but followed by an expression. For example, the expression</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var w := 5; w + w
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>returns <code>10</code>. If you're used to functional programming, you may choose to read this statement as “let” (<code>var</code>) <code>w</code> “be” (<code>:=</code>) <code>5</code> “in” (<code>;</code>) <code>w + w</code>.</p> <p>The syntax intentionally mimics that of the <code>var</code> statement, to deemphasize the distinction between statements and expressions. For example, the statement that assigns to <code>z</code> above can be written with a let expression:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var z :=
  var x, y := k, k;
  x - y;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>except that, here, the variables <code>x</code> and <code>y</code> are only in scope in the body of the let expression (which ends at the semi-colon); in the statement above, <code>x</code> and <code>y</code> are introduced as local variables, which remain in scope until the end of the lexical block. Note that the first semi-colon is a separator in the let expression, whereas the second semi-colon terminates the <code>var</code> statement.</p> <p>Local variables can be modified by assignment statements. In contrast, let-bound variables are immutable. In this light, we think of a let expression as <em>binding</em> a value to each of its let-bound variables. Whereas the right-hand side of the <code>:=</code> in a <code>var</code> statement gives initial values to the local variable, the right-hand side of the <code>:=</code> in a let expression provides <em>defining values</em> for the let-bound variables. A syntactic difference between the <code>var</code> statement and let expression is that a let expression must always include the <code>:=</code> and the accompanying defining expressions.</p> <p>The relation between <code>var</code> statements and let expressions is analogous to the relation between a <code>case</code> in a <code>match</code> statement and a <code>case</code> in a <code>match</code> expression. Recall, for the <code>match</code> constructs, each <code>case</code> takes the shape</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>case Pattern =&gt; StmtList;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>or</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>case Pattern =&gt; Expr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>respectively. Analogously, <code>var</code> statements and let expressions take the respective shapes</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x := Expr; StmtList;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>or</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x := Expr; Expr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-0-ghost-variables"><a href="#_2-0-ghost-variables" class="header-anchor">#</a> 2.0. Ghost Variables</h3> <p>Many constructs in Dafny come in two manifestations: <em>compiled</em> or <em>ghost</em>. A ghost construct is used in specifications to reason about the correctness of the program, but is erased by the compiler and has no run-time cost. Local variables and let expressions come in both manifestations. The ones we saw above were all compiled manifestations. To declare local variables or let-bound variables as ghost, simply precede the <code>var</code> keyword with <code>ghost</code>.</p> <p>For example,</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var m := 20;
ghost var n := m + 3;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>introduces a compiled variable <code>m</code> and a ghost variable <code>n</code>.</p> <p>Dafny makes sure that ghost variables (and other ghost constructs) really can be erased by the compiler without changing the meaning of the program. One of the checks it performs is that the values of compiled variables never depend on ghost variables. For example, the following declaration of <code>n</code> as a compiled variable is not legal, because the use the value of a ghost variable in an assignment to a compiled variable:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>ghost var m := 20;
var n := m + 3;  // error: illegal to assign a ghost to a compiled variable
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>When a <code>var</code> statement or let expression omits the <code>ghost</code> keyword, all variables the statement introduces are declared as compiled. And when the <code>ghost</code> keyword is present, all variables the statement introduces are declared as ghost. There is one exception to this rule. The exception applies when a <code>var</code> statement that omits the <code>ghost</code> keyword gives a method call as the right-hand side. Then, any local variable that corresponds to a ghost out-parameter of the method called is implicitly declared as ghost, and if the method itself is ghost, then all of the local variables are implicitly declared as ghost.</p> <p>For example, consider a method with two out-parameters, one compiled and one ghost:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>method M() returns (x: int, ghost y: int)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The statement</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var a, b := M();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>declares <code>a</code> to be a compiled local variable and <code>b</code> to be a ghost local variable. If the statement explicitly uses the <code>ghost</code> keyword, as in</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>ghost var a, b := M();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>then both <code>a</code> and <code>b</code> are declared to be ghost local variables.</p> <h3 id="_2-1-patterns"><a href="#_2-1-patterns" class="header-anchor">#</a> 2.1. Patterns</h3> <p>In a <code>var</code> statement and let expression, the left-hand side of <code>:=</code> need not be a list of variables, but can be a list of <em>patterns</em>, just like the patterns in the cases of a <code>match</code> construct. This has the effect of deconstructing the right-hand side of <code>:=</code> (that is, the initializing or defining expressions) and then assigning the new variables.</p> <p>For example, using the datatype definition <code>List</code> from above, the <code>var</code> statement</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var Cons(a, Cons(b, Nil)) := E;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>introduces two variables, <code>a</code> and <code>b</code>, and sets these to the first two elements of the list <code>E</code>. The value denoted by the right-hand side must match the pattern in the left-hand side, and this is enforced by the verifier. In the example, <code>E</code> must denote a list whose length is exactly <code>2</code>.</p> <p>Just like in <code>match</code> patterns, any variable that is not needed can be replaced by an underscore. For example,</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var Cons(_, Cons(b, _)) := E;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>introduces <code>b</code> and initializes it to the second element of the list <code>E</code>, where <code>E</code> is allowed to have more than two elements.</p> <p>To discard a result from the right-hand side, use an underscore as the corresponding actual out-parameter. For example, if <code>P</code> is a method with one out-parameter,</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var _ := P();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>calls <code>P()</code> and then discards its result. This is also allowed if <code>P</code> is a function, but then there's not much point in making the function call at all.</p> <h3 id="_2-2-assign-such-that-statements-and-let-such-that-expressions"><a href="#_2-2-assign-such-that-statements-and-let-such-that-expressions" class="header-anchor">#</a> 2.2. Assign-Such-That Statements and Let-Such-That Expressions</h3> <p>The <code>var</code> statements and let expressions we've seen so far are precise about what value to assign or bind to the new variables. There's is a cousin to these constructs that instead prescribes a set of values, any one of which may be picked at run-time as the value assigned. It is the <em>assign-such-that</em> statement (in statement form) and the <em>let-such-that</em> expression (in expression form).</p> <p>For example, the assign-such-that statement</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x :| x in S;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>introduces local variable <code>x</code> and says to set it to any value that satisfies the predicate <code>x in S</code>. In other words, this statement sets <code>x</code> to some value in <code>S</code>. (The verifier will complain for this example statement if it cannot prove <code>S</code> to be nonempty.)</p> <p>Syntactically, the difference between an ordinary assignment and an assign-such-that construct is that the former uses <code>:=</code> whereas the latter uses <code>:|</code>. Also, in the ordinary assignment, the variables introduced are not in scope in the right-hand side, where the variables introduced are in scope in the right-hand side of the assign-such-that constructs. Like the <code>var</code> statement and let expression, the such-that forms can introduce multiple variables, but the left-hand side is always a list of variables, never patterns.</p> <p>Here is an example <code>var</code> statement with an assign-such-that statement that introduces three new variables, <code>b</code>, <code>s</code>, and <code>t</code>. It requires that either <code>S</code> is nonempty or <code>N</code> is strictly positive.</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var b, s, t :| (b ==&gt; s in S) &amp;&amp; (!b ==&gt; 0 &lt;= t &lt; N);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The assign-such-that constructs give rise to a proof obligation that there exists some value for each of the new variables that satisfies the right-hand side. For the example above, the proof obligation thus amounts to that <code>S</code> is nonempty. A Dafny compiler may impose additional restrictions on the right-hand side, because it may not always be clever enough to generate executable code that is guaranteed to, in finite time, find values for the variables.</p> <p>The assign-such-that statement and let-such-that expression are the same, but there is an additional restriction on compiled let-such-that expressions. The restriction stems from the fact that expressions in Dafny are always deterministic, that is, if you evaluate an expression twice in the same state, you will get the same value. This is important in order to let the verifier reason about “obvious” properties like</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>E == E
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Statements, on the other hand, can be nondeterministic, so assign-such-that statements may return different values each time they are executed:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x :| x in S;
var y :| y in S;
assert x == y;  // this condition is NOT guaranteed, unless |S| == 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Dafny's guarantee that let-such-that expressions be deterministic (within each run of the program) is unproblematic for ghost expressions, but the same guarantee for <em>compiled</em> let-such-that expressions would incur too high of a run-time cost (see [<a href="http://leino.science/papers/krml266.html#leino:epsilon" target="_blank" rel="noopener noreferrer">0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]). Instead, Dafny restricts compiled such-that-expressions to those that <em>uniquely</em> specify the values of its variables. For example, if <code>S</code> is a nonempty set of integers, the compiled expression</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x :| x in S &amp;&amp; forall y :: y in S ==&gt; x &lt;= y;
x
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>is legal and evaluates to the smallest element in <code>S</code>. Unfortunately, this restriction on compiled let-such-that expressions is sometimes more harsh than one would like.</p> <h3 id="_2-3-upates"><a href="#_2-3-upates" class="header-anchor">#</a> 2.3. Upates</h3> <p>Let-bound variables get their value at the time of declaration, but local variables can be subsequently updated with assignment statements or assign-such-that statements. These are like the assignments that provide the initial value of the local variables, except that patterns in the left-hand side are allowed only when the local variables are introduced, not in subsequent assignments.<a href="http://leino.science/papers/krml266.html#fn-fn" target="_blank" rel="noopener noreferrer">0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_3-statement-expressions"><a href="#_3-statement-expressions" class="header-anchor">#</a> 3. Statement Expressions</h2> <p>Generally, statements contain expressions, but not the other way around. With one exception: the <em>statement expression</em>. It has the form <code>S; E</code>, where <code>S</code> is one of several ghost statements and <code>E</code> is an expression. The expression <code>S; E</code> evaluates to <code>E</code>. That is, statement <code>S</code> does not affect the value of the expression. The role of <code>S</code> is to provide information that will help prove the <em>well-formedness</em> of <code>E</code>.</p> <p>For example, suppose there is a function <code>F</code> and a lemma <code>AboutF</code> that tells us something about the value returned by <code>F</code>:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function method F(x: int): int
lemma AboutF(x: int)
  requires 0 &lt;= x
  ensures 0 &lt; F(x)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>In the example, the lemma <code>AboutF</code>, which can be used if <code>x</code> is non-negative, says that <code>F(x)</code> returns a positive value. Now, consider the following statement:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if 0 &lt;= y &amp;&amp; 10 / F(y) == 2 {  // error: possible division by zero
  // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Without further information, Dafny is unable to prove the absence of division-by-zero in the guard of this <code>if</code> statement. To help the verifier along, we can use the lemma. To do that, we might try calling the lemma just before the <code>if</code> statement:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>AboutF(y);  // error: precondition violation
if 0 &lt;= y &amp;&amp; 10 / F(y) == 2 {
  // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>But that doesn't work, because in that context, it could be that <code>y</code> is negative. By using a statement expression, we can insert the lemma call just where we need it:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if 0 &lt;= y &amp;&amp; 10 / (AboutF(y); F(y)) == 2 {
  // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>A statement expression accepts five kinds of statements: lemma calls and <code>assert</code>, <code>assume</code>, <code>reveal</code>, and <code>calc</code> statements.</p> <h3 id="_3-0-lemmas-with-out-parameters"><a href="#_3-0-lemmas-with-out-parameters" class="header-anchor">#</a> 3.0. Lemmas with out-parameters</h3> <p>There's a restriction on the lemma calls in statement expressions: the lemma must not have any out-parameters.<a href="http://leino.science/papers/krml266.html#fn-fnagain" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> This may be frustrating when it occasionally pops up.</p> <p>As an example, consider the following declarations:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>// Some property that integers may have
predicate P(k: int)

// A lemma that, for every x, shows---by returning a witness---the
// existence of a k satisfying P(k) 
lemma MyLemma(x: int) returns (k: int)
  ensures P(k)

// Two functions that need the P property
function method G(x: int, ghost k: int): int
  requires P(k)
function method H(x: int): int
  requires exists k :: P(k)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>It would be nice to be able to write an expression</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var k := MyLemma(x); G(x, k)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>or to write an expression</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var _ := MyLemma(x); H(x)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>when the out-parameter does not need to be named. But the restriction forbids these.</p> <p>There are workarounds. They are rather clumsy, but they show how various expressions discussed in this note can be combined to produce the desired result.</p> <p>For the latter case, a workaround is the expression</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>assert exists k :: P(k) by {
  var _ := MyLemma(x);
}
H(x)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The former is similar, but also uses a let-such-that expression to obtain a name for the value whose existence is proved by the first <code>assert</code>:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>assert exists k :: P(k) by {
  var _ := MyLemma(x);
}
ghost var k :| P(k);
G(x, k)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Note that this let-such-that expression is ghost, so the restriction that <code>k</code> must be determined uniquely does not apply.</p> <h2 id="_4-putting-it-all-together"><a href="#_4-putting-it-all-together" class="header-anchor">#</a> 4. Putting it all together</h2> <p>Dafny makes a distinction between statements and expressions, but the syntactic similarities I've discussed in this note make it less of a burden to remember what to write where. As a final example, consider the following (rather contrived) method and function for computing the same thing:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>method DoItByMethod(xs: List&lt;int&gt;) returns (r: nat)
{
  match xs
  case Nil =&gt;
    return 0;
  case Cons(x, _) =&gt;
    var square := x * x;
    AboutF(square);
    return F(square);
}

function method DoItByFunction(xs: List&lt;int&gt;): nat
{
  match xs
  case Nil =&gt;
    0
  case Cons(x, _) =&gt;
    var square := x * x;
    AboutF(square);
    F(square)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>To be technical about it, the method uses a <code>match</code> statement, a <code>var</code> statement with a local variable, a lemma call, and the final function call that computes the result, whereas the function uses a <code>match</code> expression, a let expression with a let-bound variable, a statement expression featuring a lemma call, and the final function call.</p> <p>But when you're in the midst of it, there's no need to dwell on those fine distinctions!</p> <h4 id="acknowledgments"><a href="#acknowledgments" class="header-anchor">#</a> Acknowledgments</h4> <p>I thank Matthias Schlaipfer for useful feedback on this note.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <p>[0]K. Rustan M. Leino. Compiling Hilbert's operator. In Ansgar Fehnker, Annabelle McIver, Geoff Sutcliffe, and Andrei Voronkov, editors, <em>LPAR-20. 20th International Conferences on Logic for Programming, Artificial Intelligence and Reasoning — Short Presentations</em>, volume 35 of <em>EPiC Series in Computer Science</em>, pages 106–118. EasyChair, December 2015. <a href="http://www.bing.com/search?q=Compiling+Hilbert+varepsilon+operator+++Rustan+Leino+" target="_blank" rel="noopener noreferrer">🔎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <p>0.This restriction may be removed in some future version of the language. <a href="http://leino.science/papers/krml266.html#back-fn-fn" target="_blank" rel="noopener noreferrer">↩<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>1.This restriction may be removed in some future version of the language. <a href="http://leino.science/papers/krml266.html#back-fn-fnagain" target="_blank" rel="noopener noreferrer">↩<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/aaron-clou/dafnycommunity/edit/master/docs/80.语言/30.publication-lecture/50.Statement versus Expression Syntax.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/03/26, 14:38:56</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/dafnycommunity/pages/369e25/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Short-Circuit Operators</div></a> <a href="/dafnycommunity/pages/5a4346/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">The Parent Trick for proving termination and a function-by-method use case</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dafnycommunity/pages/369e25/" class="prev">Short-Circuit Operators</a></span> <span class="next"><a href="/dafnycommunity/pages/5a4346/">The Parent Trick for proving termination and a function-by-method use case</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/dafnycommunity/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/dafnycommunity/pages/0978ce/"><div>
            寻找最大和最小数
            <!----></div></a> <span class="date">04-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/dafnycommunity/pages/e3e481/"><div>
            斐波那契数列
            <!----></div></a> <span class="date">04-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/dafnycommunity/pages/02fdef/"><div>
            线性查询
            <!----></div></a> <span class="date">04-06</span></dt></dl> <dl><dd></dd> <dt><a href="/dafnycommunity/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/Aaron-clou/dafnycommunity" title="Github" target="_blank" class="iconfont icon-github-fill"></a><a href="https://gitee.com/leo214/dafnycommunity" title="Gitee" target="_blank" class="iconfont icon-gitee2"></a><a href="1374921025@qq.com" title="Email" target="_blank" class="iconfont icon-email-fill"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Li Jiahai | Dafny Community | 2022</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="tcomment"></div><div></div></div></div>
    <script src="/dafnycommunity/assets/js/app.99d07194.js" defer></script><script src="/dafnycommunity/assets/js/2.ab4658c0.js" defer></script><script src="/dafnycommunity/assets/js/83.f08c5aed.js" defer></script><script src="/dafnycommunity/assets/js/7.5451cfed.js" defer></script><script src="/dafnycommunity/assets/js/4.06497870.js" defer></script>
  </body>
</html>
