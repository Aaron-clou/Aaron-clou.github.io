<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Iterating over a Collection | Dafny</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/dafnycommunity/img/bgico2.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3282046_1qux519eoim.css">
    <script src="https://cdn.jsdelivr.net/npm/twikoo@1.5.0/dist/twikoo.all.min.js"></script>
    <meta name="description" content="Dafny中文社区">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/dafnycommunity/assets/css/0.styles.ecdcfe28.css" as="style"><link rel="preload" href="/dafnycommunity/assets/js/app.99d07194.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/2.ab4658c0.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/80.6e5b64b0.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/7.5451cfed.js" as="script"><link rel="preload" href="/dafnycommunity/assets/js/4.06497870.js" as="script"><link rel="prefetch" href="/dafnycommunity/assets/js/10.ac38cab7.js"><link rel="prefetch" href="/dafnycommunity/assets/js/11.38d5ee16.js"><link rel="prefetch" href="/dafnycommunity/assets/js/12.c434ce94.js"><link rel="prefetch" href="/dafnycommunity/assets/js/13.4e922264.js"><link rel="prefetch" href="/dafnycommunity/assets/js/14.db841cfa.js"><link rel="prefetch" href="/dafnycommunity/assets/js/15.b9c227cc.js"><link rel="prefetch" href="/dafnycommunity/assets/js/16.41dadc32.js"><link rel="prefetch" href="/dafnycommunity/assets/js/17.48b5f1eb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/18.ec254833.js"><link rel="prefetch" href="/dafnycommunity/assets/js/19.288ca382.js"><link rel="prefetch" href="/dafnycommunity/assets/js/20.cfeb5fdb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/21.ce8ddc5a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/22.1b8c89f0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/23.cb062ace.js"><link rel="prefetch" href="/dafnycommunity/assets/js/24.ff271672.js"><link rel="prefetch" href="/dafnycommunity/assets/js/25.5541f3af.js"><link rel="prefetch" href="/dafnycommunity/assets/js/26.a1bbc4cb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/27.522d7884.js"><link rel="prefetch" href="/dafnycommunity/assets/js/28.9335c003.js"><link rel="prefetch" href="/dafnycommunity/assets/js/29.3fc0b07a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/3.ab8a97d8.js"><link rel="prefetch" href="/dafnycommunity/assets/js/30.57708681.js"><link rel="prefetch" href="/dafnycommunity/assets/js/31.8571b949.js"><link rel="prefetch" href="/dafnycommunity/assets/js/32.f91be5de.js"><link rel="prefetch" href="/dafnycommunity/assets/js/33.8089c59b.js"><link rel="prefetch" href="/dafnycommunity/assets/js/34.874d0299.js"><link rel="prefetch" href="/dafnycommunity/assets/js/35.aff8adfd.js"><link rel="prefetch" href="/dafnycommunity/assets/js/36.ac78b86e.js"><link rel="prefetch" href="/dafnycommunity/assets/js/37.3fae0334.js"><link rel="prefetch" href="/dafnycommunity/assets/js/38.3db4a8d6.js"><link rel="prefetch" href="/dafnycommunity/assets/js/39.e585cc70.js"><link rel="prefetch" href="/dafnycommunity/assets/js/40.afcb8fbe.js"><link rel="prefetch" href="/dafnycommunity/assets/js/41.01f314da.js"><link rel="prefetch" href="/dafnycommunity/assets/js/42.8e4fe21d.js"><link rel="prefetch" href="/dafnycommunity/assets/js/43.571fb232.js"><link rel="prefetch" href="/dafnycommunity/assets/js/44.14aebad2.js"><link rel="prefetch" href="/dafnycommunity/assets/js/45.32f18970.js"><link rel="prefetch" href="/dafnycommunity/assets/js/46.ce0d522f.js"><link rel="prefetch" href="/dafnycommunity/assets/js/47.0bd83351.js"><link rel="prefetch" href="/dafnycommunity/assets/js/48.648f667a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/49.83709ae0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/5.b8548e7f.js"><link rel="prefetch" href="/dafnycommunity/assets/js/50.060e0424.js"><link rel="prefetch" href="/dafnycommunity/assets/js/51.a1291856.js"><link rel="prefetch" href="/dafnycommunity/assets/js/52.45f73497.js"><link rel="prefetch" href="/dafnycommunity/assets/js/53.525782ca.js"><link rel="prefetch" href="/dafnycommunity/assets/js/54.45a04a86.js"><link rel="prefetch" href="/dafnycommunity/assets/js/55.65a94ba0.js"><link rel="prefetch" href="/dafnycommunity/assets/js/56.2d038113.js"><link rel="prefetch" href="/dafnycommunity/assets/js/57.579db650.js"><link rel="prefetch" href="/dafnycommunity/assets/js/58.832d4c89.js"><link rel="prefetch" href="/dafnycommunity/assets/js/59.13befb53.js"><link rel="prefetch" href="/dafnycommunity/assets/js/6.349bf431.js"><link rel="prefetch" href="/dafnycommunity/assets/js/60.41227bb1.js"><link rel="prefetch" href="/dafnycommunity/assets/js/61.1d1b92f4.js"><link rel="prefetch" href="/dafnycommunity/assets/js/62.2cdbc236.js"><link rel="prefetch" href="/dafnycommunity/assets/js/63.83de9482.js"><link rel="prefetch" href="/dafnycommunity/assets/js/64.4ecd0d25.js"><link rel="prefetch" href="/dafnycommunity/assets/js/65.25118b81.js"><link rel="prefetch" href="/dafnycommunity/assets/js/66.cdab1b54.js"><link rel="prefetch" href="/dafnycommunity/assets/js/67.655e6e84.js"><link rel="prefetch" href="/dafnycommunity/assets/js/68.84effb44.js"><link rel="prefetch" href="/dafnycommunity/assets/js/69.8f07f81a.js"><link rel="prefetch" href="/dafnycommunity/assets/js/70.d9a299e6.js"><link rel="prefetch" href="/dafnycommunity/assets/js/71.16ef2000.js"><link rel="prefetch" href="/dafnycommunity/assets/js/72.8252acc5.js"><link rel="prefetch" href="/dafnycommunity/assets/js/73.f53e39bc.js"><link rel="prefetch" href="/dafnycommunity/assets/js/74.5ef910c4.js"><link rel="prefetch" href="/dafnycommunity/assets/js/75.72174d00.js"><link rel="prefetch" href="/dafnycommunity/assets/js/76.bebf75c9.js"><link rel="prefetch" href="/dafnycommunity/assets/js/77.b85547c7.js"><link rel="prefetch" href="/dafnycommunity/assets/js/78.a0a1f574.js"><link rel="prefetch" href="/dafnycommunity/assets/js/79.a731d645.js"><link rel="prefetch" href="/dafnycommunity/assets/js/8.522ce892.js"><link rel="prefetch" href="/dafnycommunity/assets/js/81.6e19e312.js"><link rel="prefetch" href="/dafnycommunity/assets/js/82.9244e788.js"><link rel="prefetch" href="/dafnycommunity/assets/js/83.f08c5aed.js"><link rel="prefetch" href="/dafnycommunity/assets/js/84.085ef3f8.js"><link rel="prefetch" href="/dafnycommunity/assets/js/85.c41e6e0e.js"><link rel="prefetch" href="/dafnycommunity/assets/js/86.e3798708.js"><link rel="prefetch" href="/dafnycommunity/assets/js/87.fdac1c1c.js"><link rel="prefetch" href="/dafnycommunity/assets/js/88.665ac8c8.js"><link rel="prefetch" href="/dafnycommunity/assets/js/89.78dc55eb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/9.4d4f4bdb.js"><link rel="prefetch" href="/dafnycommunity/assets/js/90.4757b202.js"><link rel="prefetch" href="/dafnycommunity/assets/js/91.a0746cf2.js">
    <link rel="stylesheet" href="/dafnycommunity/assets/css/0.styles.ecdcfe28.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dafnycommunity/" class="home-link router-link-active"><img src="/dafnycommunity/img/logo-2.png" alt="Dafny" class="logo"> <span class="site-name can-hide">Dafny</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dafnycommunity/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="配置" class="dropdown-title"><a href="/dafnycommunity/peizhi/" class="link-title">配置</a> <span class="title" style="display:none;">配置</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>入门介绍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/56e571/" class="nav-link">什么是dafny?</a></li></ul></li><li class="dropdown-item"><h4>用起来吧！</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/4fa796/" class="nav-link">安装</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/085606/" class="nav-link">快速上手</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/39fb20/" class="nav-link">可能遇到的问题?</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/dafnycommunity/zhinan/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny快速入门</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/6e15a6/" class="nav-link">基础学习 Basic</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/eba166/" class="nav-link">方法 Method</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/83cdf9/" class="nav-link">关键字 Keyword</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/01d76e/" class="nav-link">函数 Function</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0fadc1/" class="nav-link">类 Class </a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a010ab/" class="nav-link">泛型 Generics</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/c4fda3/" class="nav-link">声明 Statement</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e8438e/" class="nav-link">表达式 Expression</a></li></ul></li><li class="dropdown-item"><h4>Dafny简单例子</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0978ce/" class="nav-link">寻找最大最小数和</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e3e481/" class="nav-link">斐波那契数列</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/02fdef/" class="nav-link">线性查询</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9b332b/" class="nav-link">引理-计算序列非负元素个数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/3d1110/" class="nav-link">集合</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2146d4/" class="nav-link">终止</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/dafnycommunity/jiaocheng/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny指导</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/877eb3/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/bf40c0/" class="nav-link">方法 Methods</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2e0c73/" class="nav-link">前置/后置条件 Pre/Postconditions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/36c1b4/" class="nav-link">断言 Assertions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a1d5a4/" class="nav-link">函数 Functions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/d89435/" class="nav-link">循环不变体 Loop Invariants</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/828a83/" class="nav-link">数组 Arrays</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/17e8d1/" class="nav-link">量词(函数) Quantifiers</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cc01af/" class="nav-link">谓词(函数) Predicates</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/13bbcd/" class="nav-link">框架 Framing</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1319be/" class="nav-link">二分搜索 Binary Search</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/30a8c2/" class="nav-link">总结</a></li></ul></li><li class="dropdown-item"><h4>Dafny进阶语法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/273cac/" class="nav-link">引理和归纳 Lemmas and Induction</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9d19b8/" class="nav-link">模块 Modules</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/b9300a/" class="nav-link">集合 sets</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cb3d21/" class="nav-link">序列 sequence</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fc6196/" class="nav-link">终止 Terminal</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a2a107/" class="nav-link">值类型 Values Types</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/dafnycommunity/ziyuan/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>实践探索</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/718207/" class="nav-link">自动归纳</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1f579f/" class="nav-link">自动调用引理</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/f6638c/" class="nav-link">定义、证明、算法正确性</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1d2420/" class="nav-link">各种推导式</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/20c275/" class="nav-link">不同类型的证明</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/67167e/" class="nav-link">集合元素上的函数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/be298d/" class="nav-link">在集合上的迭代</a></li></ul></li><li class="dropdown-item"><h4>常用工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/8065fd/" class="nav-link">Type System</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0f17ab/" class="nav-link">Style Guide</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fe5721/" class="nav-link">Cheet Sheet</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/1b94a4/" class="nav-link">✨收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️语言" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dafnycommunity/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/dafnycommunity/en-US/" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/caf1f9/" class="nav-link">💬社区留言板</a></div> <a href="https://github.com/aaron-clou/dafnycommunity" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://s1.ax1x.com/2022/04/01/qh3tDe.png"> <div class="blogger-info"><h3>Dafny</h3> <span>新一代验证语言</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/dafnycommunity/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="配置" class="dropdown-title"><a href="/dafnycommunity/peizhi/" class="link-title">配置</a> <span class="title" style="display:none;">配置</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>入门介绍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/56e571/" class="nav-link">什么是dafny?</a></li></ul></li><li class="dropdown-item"><h4>用起来吧！</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/4fa796/" class="nav-link">安装</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/085606/" class="nav-link">快速上手</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/39fb20/" class="nav-link">可能遇到的问题?</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/dafnycommunity/zhinan/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny快速入门</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/6e15a6/" class="nav-link">基础学习 Basic</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/eba166/" class="nav-link">方法 Method</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/83cdf9/" class="nav-link">关键字 Keyword</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/01d76e/" class="nav-link">函数 Function</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0fadc1/" class="nav-link">类 Class </a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a010ab/" class="nav-link">泛型 Generics</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/c4fda3/" class="nav-link">声明 Statement</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e8438e/" class="nav-link">表达式 Expression</a></li></ul></li><li class="dropdown-item"><h4>Dafny简单例子</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0978ce/" class="nav-link">寻找最大最小数和</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/e3e481/" class="nav-link">斐波那契数列</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/02fdef/" class="nav-link">线性查询</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9b332b/" class="nav-link">引理-计算序列非负元素个数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/3d1110/" class="nav-link">集合</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2146d4/" class="nav-link">终止</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/dafnycommunity/jiaocheng/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Dafny指导</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/877eb3/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/bf40c0/" class="nav-link">方法 Methods</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/2e0c73/" class="nav-link">前置/后置条件 Pre/Postconditions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/36c1b4/" class="nav-link">断言 Assertions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a1d5a4/" class="nav-link">函数 Functions</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/d89435/" class="nav-link">循环不变体 Loop Invariants</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/828a83/" class="nav-link">数组 Arrays</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/17e8d1/" class="nav-link">量词(函数) Quantifiers</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cc01af/" class="nav-link">谓词(函数) Predicates</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/13bbcd/" class="nav-link">框架 Framing</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1319be/" class="nav-link">二分搜索 Binary Search</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/30a8c2/" class="nav-link">总结</a></li></ul></li><li class="dropdown-item"><h4>Dafny进阶语法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/273cac/" class="nav-link">引理和归纳 Lemmas and Induction</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/9d19b8/" class="nav-link">模块 Modules</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/b9300a/" class="nav-link">集合 sets</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/cb3d21/" class="nav-link">序列 sequence</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fc6196/" class="nav-link">终止 Terminal</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/a2a107/" class="nav-link">值类型 Values Types</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/dafnycommunity/ziyuan/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>实践探索</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/718207/" class="nav-link">自动归纳</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1f579f/" class="nav-link">自动调用引理</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/f6638c/" class="nav-link">定义、证明、算法正确性</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/1d2420/" class="nav-link">各种推导式</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/20c275/" class="nav-link">不同类型的证明</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/67167e/" class="nav-link">集合元素上的函数</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/be298d/" class="nav-link">在集合上的迭代</a></li></ul></li><li class="dropdown-item"><h4>常用工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dafnycommunity/pages/8065fd/" class="nav-link">Type System</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/0f17ab/" class="nav-link">Style Guide</a></li><li class="dropdown-subitem"><a href="/dafnycommunity/pages/fe5721/" class="nav-link">Cheet Sheet</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/1b94a4/" class="nav-link">✨收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏷️语言" class="dropdown-title"><!----> <span class="title" style="display:;">🏷️语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dafnycommunity/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/dafnycommunity/en-US/" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/dafnycommunity/pages/caf1f9/" class="nav-link">💬社区留言板</a></div> <a href="https://github.com/aaron-clou/dafnycommunity" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dafny-quick-start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dafny-tutorials</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>detailed-document</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>publication-lecture</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dafnycommunity/pages/a9363c/" class="sidebar-link">Automatic Induction</a></li><li><a href="/dafnycommunity/pages/30441e/" class="sidebar-link">Calling Lemmas Automatically</a></li><li><a href="/dafnycommunity/pages/746026/" class="sidebar-link">Case study of definitions, proofs, algorithm correctness GCD</a></li><li><a href="/dafnycommunity/pages/da6921/" class="sidebar-link">Comprehensions</a></li><li><a href="/dafnycommunity/pages/8d8607/" class="sidebar-link">Different Styles of Proofs</a></li><li><a href="/dafnycommunity/pages/097ba0/" class="sidebar-link">Functions over Set Elements</a></li><li><a href="/dafnycommunity/pages/c4484e/" aria-current="page" class="active sidebar-link">Iterating over a Collection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_0-map-to-sequence" class="sidebar-link">0. Map to sequence</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_1-a-ghost-function" class="sidebar-link">1. A ghost function</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_2-making-the-function-compilable" class="sidebar-link">2. Making the function compilable</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_3-choosing-the-smallest-integer" class="sidebar-link">3. Choosing the smallest integer</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_4-proving-there-s-a-minimum" class="sidebar-link">4. Proving there's a minimum</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_5-total-orders" class="sidebar-link">5. Total orders</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_6-generic-set-to-sequence" class="sidebar-link">6. Generic set to sequence</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_7-total-order-has-minimum" class="sidebar-link">7. Total order has minimum</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_8-coming-back-to-map-to-sequence" class="sidebar-link">8. Coming back to map to sequence</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#_9-conclusion" class="sidebar-link">9. Conclusion</a></li><li class="sidebar-sub-header level2"><a href="/dafnycommunity/pages/c4484e/#references" class="sidebar-link">References</a></li></ul></li><li><a href="/dafnycommunity/pages/7fe522/" class="sidebar-link">old and unchanged</a></li><li><a href="/dafnycommunity/pages/369e25/" class="sidebar-link">Short-Circuit Operators</a></li><li><a href="/dafnycommunity/pages/f8c1c5/" class="sidebar-link">Statement versus Expression Syntax</a></li><li><a href="/dafnycommunity/pages/5a4346/" class="sidebar-link">The Parent Trick for proving termination and a function-by-method use case</a></li><li><a href="/dafnycommunity/pages/c45b5a/" class="sidebar-link">Type-Parameter Completion</a></li><li><a href="/dafnycommunity/pages/3c9a0b/" class="sidebar-link">Type-parameter modes variance and cardinality preservation</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/dafnycommunity/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/dafnycommunity/en-US/#语言" data-v-0c557b5e>语言</a></li><li data-v-0c557b5e><a href="/dafnycommunity/en-US/#publication-lecture" data-v-0c557b5e>publication-lecture</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/Aaron-clou" target="_blank" title="作者" class="beLink" data-v-0c557b5e>lijiahai</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-03-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Iterating over a Collection<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>Dafny Power User:
Iterating over a Collection</p> <p>K. Rustan M. Leino</p> <p>Manuscript KRML 275, 17 February 2020</p> <p><strong>Abstract.</strong> Processing the contents of a set or map in a deterministic way takes some work. Using a representative example, this note shows a way to do it.</p> <p>Mathematical collection types include sets, multisets, sequences, and maps. These are essential to specifications as well as programs. Defining functions over the elements of such collections is more difficult (or at least more labor intensive) than one would expect. In this note, I develop the program and proof for an example that converts a map to a sequence of pairs. The central part of the work concerns getting a compilable function that returns a set's elements into a predictable order.</p> <p>Throughout this note, the goal is to produce compilable functions.</p> <h2 id="_0-map-to-sequence"><a href="#_0-map-to-sequence" class="header-anchor">#</a> 0. Map to sequence</h2> <p>A map is set of key-value pairs, where no key is repeated. We can convert a map to a sequence by putting its keys into a sequence and then making pairs by retrieving the value for each key:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function method MapToSequence&lt;A,B&gt;(m: map&lt;A,B&gt;): seq&lt;(A,B)&gt; {
  var keys := SetToSequence(m.Keys);
  seq(|keys|, i requires 0 &lt;= i &lt; |keys| =&gt; (keys[i], m[keys[i]]))
}

function method SetToSequence&lt;A&gt;(s: set&lt;A&gt;): seq&lt;A&gt;
  ensures var q := SetToSequence(s);
    forall i :: 0 &lt;= i &lt; |q| ==&gt; q[i] in s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>For a map <code>m</code>, the expression <code>m.Keys</code> gives the set of keys. Function <code>MapToSequence</code> passes this set of keys to <code>SetToSequence</code> to obtain a sequence of these keys. Then, the sequence constructor</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>seq(n, f)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>produces a sequence of length <code>n</code>, where the element with index <code>i</code> is specified to be <code>f(i)</code>. In <code>MapToSequence</code>, the second argument to the sequence comprehension is a partial function given by the lambda expression</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>i requires 0 &lt;= i &lt; |keys| =&gt; (keys[i], m[keys[i]])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>For an index in the given range, this function returns a pair consisting of the key <code>keys[i]</code> and its corresponding value in <code>m</code>. It is necessary to give the range of <code>i</code> in the function's precondition, or else the expression <code>keys[i]</code> would give rise to an index-of-out-bounds error.</p> <p>To avoid a key-is-not-in-map error in the expression <code>m[keys[i]]</code>, we need to know that <code>keys[i]</code> is a key of <code>m</code>. That requires us to know a connection between <code>m.Keys</code> and <code>keys</code>, which is stated in the postcondition of the (not yet implemented) function <code>SetToSequence</code>.</p> <p>We now need to implement <code>SetToSequence</code>.</p> <h2 id="_1-a-ghost-function"><a href="#_1-a-ghost-function" class="header-anchor">#</a> 1. A ghost function</h2> <p>Let's start easy. We'll define <code>SetToSequence</code> as a ghost function. The definition is recursive. When the given set is nonempty, the function uses the choose operator, aka the let-such-that operator and written <code>:|</code>, to pick an element from the set.</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function SetToSequence&lt;A&gt;(s: set&lt;A&gt;): seq&lt;A&gt;
  ensures var q := SetToSequence(s);
    forall i :: 0 &lt;= i &lt; |q| ==&gt; q[i] in s
{
  if s == {} then [] else
    var x :| x in s;
    [x] + SetToSequence(s - {x})
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>That wasn't too bad.</p> <h2 id="_2-making-the-function-compilable"><a href="#_2-making-the-function-compilable" class="header-anchor">#</a> 2. Making the function compilable</h2> <p>To make the <code>SetToSequence</code> we wrote above compilable, we change the keyword <code>function</code> to the keyword phrase <code>function method</code>. This generates an error message:</p> <blockquote><p>to be compilable, the value of a let-such-that expression must be uniquely determined</p></blockquote> <p>Expressions—and functions, whose bodies are expressions—must be deterministic in Dafny. This means that</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>var x :| x in s;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>always needs to pick the same value for <code>x</code> when given the same <code>s</code>. This would be computationally expensive to do at run time, so Dafny instead puts this burden on the programmer (see [<a href="http://leino.science/papers/krml275.html#lpar-20:compiling_hilberts_epsilon_operator" target="_blank" rel="noopener noreferrer">0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]).</p> <p>One idea is for us to strengthen the condition <code>x in s</code> to always pick “the minimum” value from <code>s</code>. This would uniquely determine the value of the let-such-that expression. But what does “minimum” mean? Let's start with integers, where we know what minimum is, and then work up to a general situation.</p> <h2 id="_3-choosing-the-smallest-integer"><a href="#_3-choosing-the-smallest-integer" class="header-anchor">#</a> 3. Choosing the smallest integer</h2> <p>For now, we'll restrict our attention to integer sets. This lets us strengthen the condition in the let-such-that expression to uniquely talk about the minimum element of the set:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function method SetToSequence(s: set&lt;int&gt;): seq&lt;int&gt;
  ensures var q := SetToSequence(s);
    forall i :: 0 &lt;= i &lt; |q| ==&gt; q[i] in s
{
  if s == {} then [] else
    var x :| x in s &amp;&amp; forall y :: y in s ==&gt; x &lt;= y;
    [x] + SetToSequence(s - {x})
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The “uniquely determined” requirement is now satisfied. However, since our new such-that predicate is more complicated, the verifier issues a different complaint:</p> <blockquote><p>cannot establish the existence of a LHS value that satisfies the such-that predicate</p></blockquote> <p>It may seem clear to us that a nonempty set has a minimum element, but we need to convince the verifier of it. Let's do this in a separate lemma, which we declare as follows:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>lemma ThereIsAMinimum(s: set&lt;int&gt;)
  requires s != {}
  ensures exists x :: x in s &amp;&amp; forall y :: y in s ==&gt; x &lt;= y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>We'll insert a call to this lemma just before the let-such-expression in <code>SetToSequence</code>. The body of that function thus becomes</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>if s == {} then [] else
  ThereIsAMinimum(s);
  var x :| x in s &amp;&amp; forall y :: y in s ==&gt; x &lt;= y;
  [x] + SetToSequence(s - {x})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_4-proving-there-s-a-minimum"><a href="#_4-proving-there-s-a-minimum" class="header-anchor">#</a> 4. Proving there's a minimum</h2> <p>Our next task is to give a proof for the <code>ThereIsAMinimum</code> lemma. Here is an annotated proof:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>lemma ThereIsAMinimum(s: set&lt;int&gt;)
  requires s != {}
  ensures exists x :: x in s &amp;&amp; forall y :: y in s ==&gt; x &lt;= y
{
  var x :| x in s;
  if s == {x} {
    // obviously, x is the minimum
  } else {
    // The minimum in s might be x, or it might be the minimum
    // in s - {x}. If we knew the minimum of the latter, then
    // we could compare the two.
    // Let's start by giving a name to the smaller set:
    var s' := s - {x};
    // So, s is the union of s' and {x}:
    assert s == s' + {x};
    // The following lemma call establishes that there is a
    // minimum in s'.
    ThereIsAMinimum(s');
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>The proof starts by picking an arbitrary element, <code>x</code>, from <code>s</code>. It is the minimum if it's the only element in <code>s</code>. Otherwise, the proof brings out the fact that <code>s</code> is <code>s' + {x}</code>. The recursive call to the lemma gives us, through its postcondition, that there exists a minimum element in <code>s'</code>. The verifier automatically supplies the remaining proof glue, so we're done.</p> <p>The assertion in the proof may seem silly. We just defined <code>s'</code> to be <code>s - {x}</code>. Since <code>x</code> is in <code>s</code>, the property <code>s == s' + {x}</code> follows immediately. Yes, it does. The verifier can easily confirm this, but verifier is not creative enough to realize that this is a good property to know. This is typical when working with collections. For example, if you're working with a sequence <code>q</code>, you may consider <code>q[0]</code> separately and do a recursive call on <code>q[1..]</code>. If so, you're likely to need to manually supply</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>assert [q[0]] + q[1..] == q;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As with the set property, the verifier easily proves this property, but wouldn't have thought of it by itself.</p> <p>The moral of the proof is that it's a good idea, when you split a collection into smaller pieces that you want to reason about separately, to assert that the whole collection equals the combination of the smaller pieces.</p> <h2 id="_5-total-orders"><a href="#_5-total-orders" class="header-anchor">#</a> 5. Total orders</h2> <p>The restriction to integer sets above was nice to work with, because the minimum of a set of integers is easy to define and gives a unique element. To apply the same trick other types, we need to be able to define a “minimum” for those types, too. To define a minimum, you need a <em>total order</em>. Let's review what that means.</p> <p>A relation over a type <code>A</code> is a function <code>(A, A) -&gt; bool</code>. Such a relation, call it <code>R</code>, is known as a <em>partial order</em> when the following three conditions hold:</p> <ul><li><code>R</code> is reflexive, that is,
<code>forall a :: R(a, a)</code></li> <li><code>R</code> is antisymmetric, that is,
<code>forall a, b :: R(a, b) &amp;&amp; R(b, a) ==&gt; a == b</code></li> <li><code>R</code> is transitive, that is,
<code>forall a, b, c :: R(a, b) &amp;&amp; R(b, c) ==&gt; R(a, c)</code></li></ul> <p>A <em>total order</em> is a partial order that additionally satisfies the following condition:</p> <ul><li><code>R</code> is connex (closely connected), that is,
<code>forall a, b :: R(a, b) || R(b, a)</code></li></ul> <p>Note that connexity implies reflexivity.</p> <p>Here is a predicate that says whether or not a given relation is a total order:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>predicate IsTotalOrder&lt;A(!new)&gt;(R: (A, A) -&gt; bool) {
  // connexity
  &amp;&amp; (forall a, b :: R(a, b) || R(b, a))
  // antisymmetry
  &amp;&amp; (forall a, b :: R(a, b) &amp;&amp; R(b, a) ==&gt; a == b)
  // transitivity
  &amp;&amp; (forall a, b, c :: R(a, b) &amp;&amp; R(b, c) ==&gt; R(a, c))
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Dafny won't allow us to write these quantifiers in the predicate, unless it knows a little more about type <code>A</code>. If <code>A</code> were a class type, then <code>forall</code> in Dafny means quantifying over the <em>allocated</em> instances of class <code>A</code>. That would mean that allocating another <code>A</code> instance could cause <code>IsTotalOrder(R)</code> to change values. To prevent this, Dafny insists that unbounded quantifications like those in <code>IsTotalOrder</code> be over types that do not depend on the allocated state. We express that with the <em>type characteristic</em> <code>(!new)</code>, which is written as a suffix of the type name in the type-parameter declaration.</p> <h2 id="_6-generic-set-to-sequence"><a href="#_6-generic-set-to-sequence" class="header-anchor">#</a> 6. Generic set to sequence</h2> <p>We revise <code>SetToSequence</code> to also take a relation, <code>R</code>, which we require to be a total order. In doing so, we change the total order <code>&lt;=</code> on integers to <code>R</code>, and we also add <code>R</code> as a parameter to the <code>ThereIsAMinimum</code> lemma:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function method SetToSequence&lt;A(!new)&gt;(s: set&lt;A&gt;, R: (A, A) -&gt; bool): seq&lt;A&gt;
  requires IsTotalOrder(R)
  ensures var q := SetToSequence(s, R);
    forall i :: 0 &lt;= i &lt; |q| ==&gt; q[i] in s
{
  if s == {} then [] else
    ThereIsAMinimum(s, R);
    var x :| x in s &amp;&amp; forall y :: y in s ==&gt; R(x, y);
    [x] + SetToSequence(s - {x}, R)
}

lemma ThereIsAMinimum&lt;A(!new)&gt;(s: set&lt;A&gt;, R: (A, A) -&gt; bool)
  requires s != {} &amp;&amp; IsTotalOrder(R)
  ensures exists x :: x in s &amp;&amp; forall y :: y in s ==&gt; R(x, y)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The revised <code>SetToSequence</code> lemma verifies. Our remaining task is to prove the lemma.</p> <h2 id="_7-total-order-has-minimum"><a href="#_7-total-order-has-minimum" class="header-anchor">#</a> 7. Total order has minimum</h2> <p>We start the proof of our generic <code>ThereIsAMinimum</code> like the analogous proof for integer sets above:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>{
  var x :| x in s;
  if s == {x} {  // error: postcondition might not hold on this return path
  } else {
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The case that was “obvious” before is causing the verifier trouble this time. Let's help it out. Our proof obligation is to show there's some element in <code>s</code> that is as small as any element in <code>s</code>. If <code>s</code> is the singleton set <code>{x}</code>, then the element we're looking for can only be <code>x</code>. Now, if <code>y</code> is an element in <code>s</code>, we need to prove <code>R(x, y)</code>. Since <code>s</code> is a singleton, we have <code>y == x</code>, and then <code>R(x, y)</code> follows from connexity. The verifier is missing one of both of these facts. Let's add an assertion about the first fact:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>  if s == {x} {
    assert forall y :: y in s ==&gt; x == y;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Ah, yes, the verifier can prove this assertion and can then do the rest of the proof.</p> <p>On to the non-singleton case. We'll start like in the integer-set proof above:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>  } else {
    var s' := s - {x};
    assert s == s' + {x};
    ThereIsAMinimum(s', R);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The verifier complains the lemma's postcondition might not hold, so we'll give the verifier more help.</p> <p>The recursive call to the lemma (which, by the way, is known as “the induction hypothesis”) says there is a minimum in <code>s'</code>. Let's give it a name, which we do by introducing a local variable whose value we constrain to satisfy the condition in the lemma's postcondition's existential quantifier:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>    var z :| z in s' &amp;&amp; forall y :: y in s' ==&gt; R(z, y);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Since <code>s</code> is <code>s' + {x}</code>, the minimum we're looking for is either <code>z</code> or <code>x</code>. Let's treat these cases separately. We do that by using an <code>if</code> statement. Since the two cases are so symmetric, I think it looks nice to use Dafny's if-case statement:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>    // by connexity, one of the two cases below applies
    if
    case R(z, x) =&gt;
      // prove z is the minimum not just of s', but of s
      // ...
    case R(x, z) =&gt;
      // prove x is the minimum of s
      // ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Let's do the <code>R(z, x)</code> case first. The hard part is likely to be the quantifier in the postcondition, so let's start with it. To give a proof of a universal quantifier, you use a <code>forall</code> statement.</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>      forall y | y in s
        ensures R(z, y)
      {
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>From <code>y in s</code>, we know either <code>y</code> is <code>x</code> or <code>y</code> is in <code>s'</code>. For the former, the proof follows from the guard <code>R(z, x)</code>. For the latter, the proof follows from the quantification in the such-that condition we used to introduce <code>z</code>. Somehow, the verifier is not picking up on this, so let's help it along. We start here:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>        assert x == y || y in s';
      }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Lo and behold! That's all the verifier needed.</p> <p>In the <code>R(x, z)</code> case, we'll lay down the analogous <code>forall</code> statement to prove the quantifier in the lemma's postcondition:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>      forall y | y in s
        ensures R(x, y)
      {
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>If <code>y</code> is <code>x</code>, then <code>R(x, y)</code> follows from connexity. On the other hand, if <code>y</code> is in <code>s'</code>, then the such-that condition that introduced <code>z</code> tells us <code>R(z, y)</code>, so we get <code>R(x, y)</code> by transitivity. You may add these hints in various ways to make the proof go through. Here is one way:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>        assert y in s' ==&gt; R(z, y);
      }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>A final remark. When we proved <code>ThereIsAMinimum</code> for integer sets, I argued that it's often useful to include an assertion like:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>    assert s == s' + {x};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>I included it in the generic <code>ThereIsAMinimum</code> as well. But as it turns out, it's not actually needed there (because we made up for it in the additional hints we gave in the two cases), so you can delete it, if you want.</p> <h2 id="_8-coming-back-to-map-to-sequence"><a href="#_8-coming-back-to-map-to-sequence" class="header-anchor">#</a> 8. Coming back to map to sequence</h2> <p>We did it!</p> <p>Well, before we declare success, let's just make sure we can use our functions and lemmas to write the <code>MapToSequence</code> function that we set out to write. Here's the generic version, which needs a given total order:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function method MapToSequence&lt;A(!new),B&gt;(m: map&lt;A,B&gt;, R: (A, A) -&gt; bool): seq&lt;(A,B)&gt;
  requires IsTotalOrder(R)
{
  var keys := SetToSequence(m.Keys, (a,a') =&gt; R(a, a'));
  seq(|keys|, i requires 0 &lt;= i &lt; |keys| =&gt; (keys[i], m[keys[i]]))
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>We can also specialize it for integer sets:</p> <div class="language-dafnyx line-numbers-mode"><pre class="language-text"><code>function method IntMapToSequence&lt;B&gt;(m: map&lt;int,B&gt;): seq&lt;(int,B)&gt; {
  MapToSequence(m, (a, a') =&gt; a &lt;= a')
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>We did it!</p> <h2 id="_9-conclusion"><a href="#_9-conclusion" class="header-anchor">#</a> 9. Conclusion</h2> <p>I hope this long journey showed you a thing or two about working with collections in Dafny.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <p>[0]K. Rustan M. Leino. Compiling Hilbert's epsilon operator. In Ansgar Fehnker, Annabelle McIver, Geoff Sutcliffe, and Andrei Voronkov, editors, <em>LPAR-20. 20th International Conferences on Logic for Programming, Artificial Intelligence and Reasoning — Short Presentations</em>, volume 35 of <em>EPiC Series in Computing</em>, pages 106–118. EasyChair, 2015. <a href="http://www.bing.com/search?q=Compiling+Hilbert+epsilon+operator+++Rustan+Leino+" target="_blank" rel="noopener noreferrer">🔎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/aaron-clou/dafnycommunity/edit/master/docs/80.语言/30.publication-lecture/35.Iterating over a Collection.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/03/26, 14:38:56</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/dafnycommunity/pages/097ba0/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Functions over Set Elements</div></a> <a href="/dafnycommunity/pages/7fe522/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">old and unchanged</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dafnycommunity/pages/097ba0/" class="prev">Functions over Set Elements</a></span> <span class="next"><a href="/dafnycommunity/pages/7fe522/">old and unchanged</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/dafnycommunity/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/dafnycommunity/pages/0978ce/"><div>
            寻找最大和最小数
            <!----></div></a> <span class="date">04-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/dafnycommunity/pages/e3e481/"><div>
            斐波那契数列
            <!----></div></a> <span class="date">04-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/dafnycommunity/pages/02fdef/"><div>
            线性查询
            <!----></div></a> <span class="date">04-06</span></dt></dl> <dl><dd></dd> <dt><a href="/dafnycommunity/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/Aaron-clou/dafnycommunity" title="Github" target="_blank" class="iconfont icon-github-fill"></a><a href="https://gitee.com/leo214/dafnycommunity" title="Gitee" target="_blank" class="iconfont icon-gitee2"></a><a href="1374921025@qq.com" title="Email" target="_blank" class="iconfont icon-email-fill"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Li Jiahai | Dafny Community | 2022</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="tcomment"></div><div></div></div></div>
    <script src="/dafnycommunity/assets/js/app.99d07194.js" defer></script><script src="/dafnycommunity/assets/js/2.ab4658c0.js" defer></script><script src="/dafnycommunity/assets/js/80.6e5b64b0.js" defer></script><script src="/dafnycommunity/assets/js/7.5451cfed.js" defer></script><script src="/dafnycommunity/assets/js/4.06497870.js" defer></script>
  </body>
</html>
